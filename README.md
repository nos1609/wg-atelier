# wg-atelier

[English version üá¨üáß](README.en.md)

## –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ

**wg-atelier** ‚Äî —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π —É—Ç–∏–ª–∏—Ç—ã `generate_wg_configs.py`, –∫–æ—Ç–æ—Ä–∞—è —Å–æ–±–∏—Ä–∞–µ—Ç –ø–æ–ª–Ω—ã–π –Ω–∞–±–æ—Ä WireGuard-–∫–æ–Ω—Ñ–∏–≥–æ–≤ –Ω–∞ –æ—Å–Ω–æ–≤–µ –æ–ø–∏—Å–∞–Ω–∏—è —Å–µ—Ä–≤–µ—Ä–∞ (`wg_config.yaml`), —Å–ø–∏—Å–∫–∞ –ø–æ–¥—Å–µ—Ç–µ–π (`subnets.csv`) –∏ —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –∫–ª–∏–µ–Ω—Ç—Å–∫–∏—Ö –ø—Ä–æ—Ñ–∏–ª–µ–π. –°–∫—Ä–∏–ø—Ç –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ—Ç –ø—Ä–∏–≤–∞—Ç–Ω—ã–µ –∫–ª—é—á–∏, —Å–ª–µ–¥–∏—Ç –∑–∞ PSK –∏ —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç –∫–∞–∫ —Å–µ—Ä–≤–µ—Ä–Ω—ã–π —Ñ–∞–π–ª `server/wg0.conf`, —Ç–∞–∫ –∏ –∫–ª–∏–µ–Ω—Ç—Å–∫–∏–µ –ø—Ä–æ—Ñ–∏–ª–∏ —Å QR-–∫–æ–¥–∞–º–∏.

## –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- —á—Ç–µ–Ω–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ —Å–µ—Ä–≤–µ—Ä–∞ –∏ AmneziaWG –∏–∑ YAML;
- –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Å–≤–µ—Ä–∫–∞ CSV —Å —Å–æ–¥–µ—Ä–∂–∏–º—ã–º `clients/<subnet>/` –∏ –¥–æ–∑–∞–ø—Ä–æ—Å –¥–µ–π—Å—Ç–≤–∏–π –ø—Ä–∏ —Ä–∞—Å—Ö–æ–∂–¥–µ–Ω–∏—è—Ö;
- —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–µ—Ä–≤–µ—Ä–Ω–æ–≥–æ –∏ –∫–ª–∏–µ–Ω—Ç—Å–∫–∏—Ö –∫–æ–Ω—Ñ–∏–≥–æ–≤, –≥–µ–Ω–µ—Ä–∞—Ü–∏—è QR-–∫–æ–¥–æ–≤;
- –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ `wg-atelier.log` –∏ —Å–æ–∑–¥–∞–Ω–∏–µ —Ä–µ–∑–µ—Ä–≤–Ω—ã—Ö –∫–æ–ø–∏–π `wg_config.yaml.<timestamp>.bak` –ø—Ä–∏ –∞–≤—Ç–æ–∑–∞–ø–∏—Å–∏ –∫–ª—é—á–µ–π;
- –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞—è —Ä–∞–±–æ—Ç–∞ —Å PSK (–ø–æ–¥—Ç—è–≥–∏–≤–∞–Ω–∏–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –∑–Ω–∞—á–µ–Ω–∏–π, –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –ø–µ—Ä–µ–¥ —Ä–µ–≥–µ–Ω–µ—Ä–∞—Ü–∏–µ–π);
- —Ä–µ–∂–∏–º `--validate` –¥–ª—è ¬´—Å—É—Ö–æ–π¬ª –ø—Ä–æ–≤–µ—Ä–∫–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –±–µ–∑ –∑–∞–ø–∏—Å–∏ —Ñ–∞–π–ª–æ–≤.

## –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

### –í–Ω–µ—à–Ω–∏–µ CLI
- `wg` (`wireguard-tools`) ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–ª—é—á–µ–π, –ø–æ–ª—É—á–µ–Ω–∏–µ public key, —Å–æ–∑–¥–∞–Ω–∏–µ PSK.
- `wireguard-vanity-address` ‚Äî —Ç—Ä–µ–±—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø—Ä–∏ `vanity_length > 0`.
- –°–∫—Ä–∏–ø—Ç –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –ø–æ–¥ Python 3.10\+ –Ω–∞ Windows.

### Python
- Python 3.10+.
- –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ —Ñ–∏–∫—Å–∏—Ä—É—é—Ç—Å—è –≤ `requirements.txt` (—É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ `pip install -r requirements.txt`).

## –í—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ

### `wg_config.yaml`
- –±–ª–æ–∫ `server`: `endpoint`, `ipv4`, `ipv6`, `private_key`, –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ `port`, `dns_ipv4`/`dns_ipv6`, `keepalive_on_server`, `amneziawg_on_server`, `mtu`, `mtu_comment`.
- –±–ª–æ–∫ `client_defaults`: `persistent_keepalive`, `vanity_length`, `mtu_comment` (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –Ω–∞—Å–ª–µ–¥—É–µ—Ç —Å–µ—Ä–≤–µ—Ä–Ω—ã–π —à–∞–±–ª–æ–Ω).
- –±–ª–æ–∫ `psk`: `mode` (`generate`/`generate_per_client`/`static`), `value` –¥–ª—è —Å—Ç–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —Ä–µ–∂–∏–º–∞, `reuse` –¥–ª—è –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –Ω–∞–π–¥–µ–Ω–Ω–æ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è.
- –±–ª–æ–∫ `amneziawg`: –ø–∞—Ä–∞–º–µ—Ç—Ä—ã JunkPacket/RandomData/Handshake/Transport.

### `subnets.csv`
- —Ñ–æ—Ä–º–∞—Ç `prefix;num_clients` (—Å–º. `subnets.example.csv`).
- –ø–æ—Ä—è–¥–æ–∫ —Å—Ç—Ä–æ–∫ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –ø–æ—Ä—è–¥–æ–∫ –ø–æ–¥—Å–µ—Ç–µ–π –≤ –≤—ã—Ö–æ–¥–Ω—ã—Ö —Ñ–∞–π–ª–∞—Ö.

### –°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –∫–ª–∏–µ–Ω—Ç—ã
- `clients/<prefix>/<prefix>_clientN.conf` –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –∫–∞–∫ –∏—Å—Ç–æ—á–Ω–∏–∫ –ø—Ä–∏–≤–∞—Ç–Ω—ã—Ö –∫–ª—é—á–µ–π/PSK.
- –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ —Å—Ç—Ä–æ–∫–∏ –∏–∑ CSV —Å–∫—Ä–∏–ø—Ç —Å–ø—Ä–æ—Å–∏—Ç, –Ω—É–∂–Ω–æ –ª–∏ —É–¥–∞–ª–∏—Ç—å –∫–∞—Ç–∞–ª–æ–≥ –ø–æ–¥—Å–µ—Ç–∏.

## –ó–∞–ø—É—Å–∫

1. –ü–æ–¥–≥–æ—Ç–æ–≤—å—Ç–µ `wg_config.yaml` –∏ `subnets.csv`, –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –æ—á–∏—Å—Ç–∏—Ç–µ –ª–∏—à–Ω–∏–µ –∫–∞—Ç–∞–ª–æ–≥–∏ –≤ `clients/`.
2. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ (`pip install -r requirements.txt`) –∏ —É–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ `wg`/`wireguard-vanity-address` –¥–æ—Å—Ç—É–ø–Ω—ã –≤ PATH.
3. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä:
   ```
   python generate_wg_configs.py -c config/wg_config.yaml -s data/subnets.csv -o ./artifacts
   ```
   –î–ª—è ¬´—Å—É—Ö–æ–π¬ª –ø—Ä–æ–≤–µ—Ä–∫–∏ –±–µ–∑ –∑–∞–ø–∏—Å–∏ —Ñ–∞–π–ª–æ–≤: `python generate_wg_configs.py --validate`.
4. –°–ª–µ–¥—É–π—Ç–µ –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–º –ø–æ–¥—Å–∫–∞–∑–∫–∞–º (–ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —É–¥–∞–ª–µ–Ω–∏—è –ø–æ–¥—Å–µ—Ç–µ–π, –ø–µ—Ä–µ–Ω–æ—Å PSK, —á—Ç–µ–Ω–∏–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤).

| –ö–ª—é—á | –û–ø–∏—Å–∞–Ω–∏–µ |
| --- | --- |
| `-c/--config` | –ü—É—Ç—å –∫ `wg_config.yaml` |
| `-s/--subnets` | –ü—É—Ç—å –∫ `subnets.csv` |
| `-o/--output-root` | –ö–∞—Ç–∞–ª–æ–≥, –∫—É–¥–∞ –±—É–¥—É—Ç –∑–∞–ø–∏—Å–∞–Ω—ã `server/` –∏ `clients/` |
| `--validate` | –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –±–µ–∑ –∑–∞–ø–∏—Å–∏ —Ñ–∞–π–ª–æ–≤ |

> `WG_CONFIG_GEN_ASSUME_YES=1` –æ—Ç–∫–ª—é—á–∞–µ—Ç –≤—Å–µ –∑–∞–ø—Ä–æ—Å—ã –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è. –í–∫–ª—é—á–∞–π—Ç–µ —Ç–æ–ª—å–∫–æ –≤ –ø–æ–ª–Ω–æ—Å—Ç—å—é –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ–º–æ–π —Å—Ä–µ–¥–µ.

## PSK, AmneziaWG –∏ keepalive

- `psk: generate` ‚Äî —Å–æ–∑–¥–∞—ë—Ç—Å—è –æ–±—â–∏–π PSK, –ø–æ—Å–ª–µ —á–µ–≥–æ —Ä–µ–∂–∏–º –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ–∫–ª—é—á–∞–µ—Ç—Å—è –Ω–∞ `static`.
- `psk: generate_per_client` ‚Äî –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∫–ª–∏–µ–Ω—Ç–∞ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω—ã–π PSK.
- `psk: static` + `value` ‚Äî –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≥–æ—Ç–æ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ (—Å—Ç—Ä–æ–∫–∞ Base64, 32 –±–∞–π—Ç–∞). –ü—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ –∑–Ω–∞—á–µ–Ω–∏—è –º–æ–∂–Ω–æ –ø–æ–¥—Ç—è–Ω—É—Ç—å PSK –∏–∑ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤.
- `psk.reuse=true` –∑–∞—Å—Ç–∞–≤–ª—è–µ—Ç —Å–∫—Ä–∏–ø—Ç –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –Ω–∞–π–¥–µ–Ω–Ω—ã–π PSK, `false` ‚Äî —Ç—Ä–µ–±—É–µ—Ç —è–≤–Ω–æ–≥–æ —Å–æ–≥–ª–∞—Å–∏—è –ø–µ—Ä–µ–¥ —Ä–µ–≥–µ–Ω–µ—Ä–∞—Ü–∏–µ–π.
- `amneziawg_on_server` + –±–ª–æ–∫ `amneziawg` –¥–æ–±–∞–≤–ª—è—é—Ç –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –∏ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –≤ `[Interface]` —Å–µ—Ä–≤–µ—Ä–∞ –∏ –∫–ª–∏–µ–Ω—Ç–æ–≤.
- `persistent_keepalive` –≤—Å–µ–≥–¥–∞ –ø—Ä–æ–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –∫–ª–∏–µ–Ω—Ç–∞–º; –ø—Ä–∏ `keepalive_on_server=true` —Ç–æ –∂–µ –∑–Ω–∞—á–µ–Ω–∏–µ –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –≤ —Å–µ—Ä–≤–µ—Ä–Ω—ã–π –∫–æ–Ω—Ñ–∏–≥.

## Vanity-–∫–ª—é—á–∏

- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø—Ä–µ—Ñ–∏–∫—Å `name[:vanity_length]`.
- –ü—Ä–∏ `vanity_length=0` —Å–∫—Ä–∏–ø—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ–∫–ª—é—á–∞–µ—Ç—Å—è –Ω–∞ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—É—é –≥–µ–Ω–µ—Ä–∞—Ü–∏—é `wg genkey`.
- –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –¥–ª–∏–Ω–∞ –ø—Ä–µ—Ñ–∏–∫—Å–∞ ‚Äî 10 —Å–∏–º–≤–æ–ª–æ–≤ (–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –≤—Å—Ç—Ä–æ–µ–Ω–æ –≤ —Å–∫—Ä–∏–ø—Ç).

## –õ–æ–≥–∏ –∏ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞

- –û—Å–Ω–æ–≤–Ω–æ–π –ª–æ–≥: `wg-atelier.log`.
- –ü—Ä–∏ –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏–∏ Ctrl+C –ª–æ–≤–∏—Ç—Å—è `KeyboardInterrupt`, –∑–∞–ø–∏—Å—å –ø–æ–ø–∞–¥–∞–µ—Ç –≤ –ª–æ–≥.
- –î–ª—è –∞–Ω–∞–ª–∏–∑–∞ –ø—Ä–æ–±–ª–µ–º –ø–æ–ª–µ–∑–Ω–æ –∑–∞–ø—É—Å–∫–∞—Ç—å `python -m py_compile generate_wg_configs.py` –∏ `python generate_wg_configs.py --validate` –ø–µ—Ä–µ–¥ –ø—É–±–ª–∏–∫–∞—Ü–∏–µ–π.

## –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- –ü—Ä–∏–≤–∞—Ç–Ω—ã–µ –∫–ª—é—á–∏ –∏ –∫–æ–Ω—Ñ–∏–≥–∏ –Ω–µ –¥–æ–ª–∂–Ω—ã –ø–æ–∫–∏–¥–∞—Ç—å –ª–æ–∫–∞–ª—å–Ω—É—é –º–∞—à–∏–Ω—É.
- –°–∫—Ä–∏–ø—Ç –≤—ã—Å—Ç–∞–≤–ª—è–µ—Ç –ø—Ä–∞–≤–∞ `0600` –Ω–∞ –∫–æ–Ω—Ñ–∏–≥–∏ (–Ω–∞ Windows ‚Äî —á–µ—Ä–µ–∑ `icacls`, –æ—Ç–∫–ª—é—á–∞—è –Ω–∞—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ –∏ –≤—ã–¥–∞–≤–∞—è –ø—Ä–∞–≤–∞ —Ç–µ–∫—É—â–µ–º—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é). –ü—Ä–æ–≤–µ—Ä—è–π—Ç–µ, —á—Ç–æ –∫–∞—Ç–∞–ª–æ–≥–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã –ø–æ—Å—Ç–æ—Ä–æ–Ω–Ω–∏–º.
- –†–µ–∑–µ—Ä–≤–Ω—ã–µ –∫–æ–ø–∏–∏ `wg_config.yaml.<timestamp>.bak` –∏–≥–Ω–æ—Ä–∏—Ä—É—é—Ç—Å—è Git; —Ö—Ä–∞–Ω–∏—Ç–µ –∏—Ö –≤ –∑–∞—â–∏—â—ë–Ω–Ω–æ–º –º–µ—Å—Ç–µ –∏–ª–∏ —É–¥–∞–ª—è–π—Ç–µ –≤—Ä—É—á–Ω—É—é.
- –ü–µ—Ä–µ–¥ –ø—É–±–ª–∏–∫–∞—Ü–∏–µ–π —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –ø—Ä–æ–≥–æ–Ω—è—Ç—å `gitleaks detect --source . --redact`.
- –ù–µ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `WG_CONFIG_GEN_ASSUME_YES` –≤ –Ω–µ–ø—Ä–æ–≤–µ—Ä–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è—Ö: –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–≥–ª–∞—Å–∏–µ –º–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ –ø–æ—Ç–µ—Ä–µ –∫–ª—é—á–µ–π.
